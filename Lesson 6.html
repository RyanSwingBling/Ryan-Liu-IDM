<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dublin Weather - JSON Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .weather-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }
        
        .location {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .location h1 {
            margin: 0;
            color: #333;
            font-size: 36px;
        }
        
        .location p {
            margin: 5px 0;
            color: #666;
            font-size: 18px;
        }
        
        .weather-main {
            text-align: center;
            margin: 30px 0;
        }
        
        .temperature {
            font-size: 72px;
            font-weight: bold;
            color: #667eea;
            margin: 0;
        }
        
        .description {
            font-size: 24px;
            color: #555;
            text-transform: capitalize;
            margin: 10px 0;
        }
        
        .weather-icon {
            font-size: 80px;
            margin: 20px 0;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .detail-item {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .detail-label {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .detail-value {
            color: #333;
            font-size: 24px;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 20px;
        }
        
        .error {
            text-align: center;
            color: #e74c3c;
            font-size: 18px;
        }
        
        .update-time {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 20px;
        }

        .json-section {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .json-title {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .json-display {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px 0 0;
            transition: background 0.3s;
        }

        button:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="weather-container">
        <div class="location">
            <h1>Dublin</h1>
            <p>Ireland</p>
        </div>
        
        <div id="weatherContent" class="loading">
            Loading weather data...
        </div>

        <!-- JSON Section -->
        <div class="json-section">
            <div class="json-title">üìã Raw JSON Data from API:</div>
            <button onclick="toggleJSON()">Show/Hide JSON</button>
            <button onclick="downloadJSON()">Download JSON</button>
            <div id="jsonDisplay" class="json-display" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Storing the JSON data globally
        let weatherJSON = null;

        // Fetching weather data for Dublin
        async function getWeather() {
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=53.3498&longitude=-6.2603&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m&timezone=Europe/Dublin`;
            
            try {
                // Fetching the data
                const response = await fetch(apiUrl);
                
                // Converting response to JSON using JSON.parse() (happens automatically with .json())
                const data = await response.json();
                
                // Storing the JSON data
                weatherJSON = data;
                
                // Displaying the JSON in the console
                console.log('Raw JSON Response:', JSON.stringify(data, null, 2));
                
                // Displaying the weather using the parsed JSON data
                displayWeather(data);
                
                // Displaying the raw JSON on the page
                displayRawJSON(data);
                
            } catch (error) {
                document.getElementById('weatherContent').innerHTML = 
                    '<p class="error">Unable to load weather data. Please try again later.</p>';
                console.error('Error fetching weather:', error);
            }
        }
        
        // JSON object containing weather code mappings
        const weatherCodesJSON = {
            "0": { "desc": "Clear sky", "icon": "‚òÄÔ∏è" },
            "1": { "desc": "Mainly clear", "icon": "üå§Ô∏è" },
            "2": { "desc": "Partly cloudy", "icon": "‚õÖ" },
            "3": { "desc": "Overcast", "icon": "‚òÅÔ∏è" },
            "45": { "desc": "Foggy", "icon": "üå´Ô∏è" },
            "48": { "desc": "Foggy", "icon": "üå´Ô∏è" },
            "51": { "desc": "Light drizzle", "icon": "üå¶Ô∏è" },
            "53": { "desc": "Moderate drizzle", "icon": "üå¶Ô∏è" },
            "55": { "desc": "Dense drizzle", "icon": "üåßÔ∏è" },
            "61": { "desc": "Slight rain", "icon": "üåßÔ∏è" },
            "63": { "desc": "Moderate rain", "icon": "üåßÔ∏è" },
            "65": { "desc": "Heavy rain", "icon": "‚õàÔ∏è" },
            "71": { "desc": "Slight snow", "icon": "üå®Ô∏è" },
            "73": { "desc": "Moderate snow", "icon": "üå®Ô∏è" },
            "75": { "desc": "Heavy snow", "icon": "‚ùÑÔ∏è" },
            "80": { "desc": "Rain showers", "icon": "üå¶Ô∏è" },
            "81": { "desc": "Rain showers", "icon": "üåßÔ∏è" },
            "82": { "desc": "Heavy rain showers", "icon": "‚õàÔ∏è" },
            "95": { "desc": "Thunderstorm", "icon": "‚õàÔ∏è" },
            "96": { "desc": "Thunderstorm with hail", "icon": "‚õàÔ∏è" },
            "99": { "desc": "Thunderstorm with hail", "icon": "‚õàÔ∏è" }
        };

        // Converting weather codes JSON to display format
        console.log('Weather Codes as JSON:', JSON.stringify(weatherCodesJSON, null, 2));
        
        function getWeatherDescription(code) {
            // Accessing data from JSON object
            return weatherCodesJSON[code] || { "desc": "Unknown", "icon": "üå°Ô∏è" };
        }
        
        function displayWeather(data) {
            // Parsing data from JSON response
            const current = data.current;
            const weatherInfo = getWeatherDescription(current.weather_code);
            
            // Creating weather display object
            const weatherDisplay = {
                "location": {
                    "city": "Dublin",
                    "country": "Ireland"
                },
                "current": {
                    "temperature": Math.round(current.temperature_2m),
                    "feelsLike": Math.round(current.apparent_temperature),
                    "humidity": current.relative_humidity_2m,
                    "windSpeed": Math.round(current.wind_speed_10m),
                    "precipitation": current.precipitation,
                    "description": weatherInfo.desc,
                    "icon": weatherInfo.icon
                },
                "lastUpdated": new Date().toLocaleTimeString('en-IE')
            };

            console.log('Weather Display Object as JSON:', JSON.stringify(weatherDisplay, null, 2));
            
            const weatherHTML = `
                <div class="weather-main">
                    <div class="weather-icon">${weatherDisplay.current.icon}</div>
                    <p class="temperature">${weatherDisplay.current.temperature}¬∞C</p>
                    <p class="description">${weatherDisplay.current.description}</p>
                </div>
                
                <div class="weather-details">
                    <div class="detail-item">
                        <div class="detail-label">Feels Like</div>
                        <div class="detail-value">${weatherDisplay.current.feelsLike}¬∞C</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Humidity</div>
                        <div class="detail-value">${weatherDisplay.current.humidity}%</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Wind Speed</div>
                        <div class="detail-value">${weatherDisplay.current.windSpeed} km/h</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Precipitation</div>
                        <div class="detail-value">${weatherDisplay.current.precipitation} mm</div>
                    </div>
                </div>
                
                <p class="update-time">Last updated: ${weatherDisplay.lastUpdated}</p>
            `;
            
            document.getElementById('weatherContent').innerHTML = weatherHTML;
        }

        function displayRawJSON(data) {
            // Converting JavaScript object to JSON string using JSON.stringify()
            const jsonString = JSON.stringify(data, null, 2);
            document.getElementById('jsonDisplay').textContent = jsonString;
        }

        function toggleJSON() {
            const jsonDisplay = document.getElementById('jsonDisplay');
            if (jsonDisplay.style.display === 'none') {
                jsonDisplay.style.display = 'block';
            } else {
                jsonDisplay.style.display = 'none';
            }
        }

        function downloadJSON() {
            if (!weatherJSON) {
                alert('No weather data available to download!');
                return;
            }

            // Converting object to JSON string
            const jsonString = JSON.stringify(weatherJSON, null, 2);
            
            // Creating a blob from the JSON string
            const blob = new Blob([jsonString], { type: 'application/json' });
            
            // Creating a download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dublin-weather.json';
            a.click();
            
            // Clean up
            URL.revokeObjectURL(url);
            
            console.log('JSON file downloaded!');
        }
        
        // Loading weather when page loads
        getWeather();
        
    </script>
</body>
</html>